{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
  {{ block.super }}
  <script src="{% static 'inventory/js/admin/changelist_auto_submit.js' %}"></script>
{% endblock %}

{% block object-tools-items %}
  <li>
    <a class="addlink" style="background-color:#28a745; color:white;"
       href="export-csv/">
      üì• Template —Ç–∞—Ç–∞—Ö
    </a>
  </li>
  {{ block.super }}
{% endblock %}

{% block search %}
  {# –ê–õ–î–ê–ê –ó–ê–°–ê–í: {{ block.super }}-–∏–π–≥ —Ö–∞—Å—Å–∞–Ω (–¥–∞–≤—Ö–∞—Ä —Ö–∞–π–ª—Ç “Ø“Ø—Å–≥—ç—Ö–≥“Ø–π–Ω —Ç—É–ª–¥) #}
  
  <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background-color: #f9f9f9;">
    <form id="dev-filter-form" method="get" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      
      {# –ë—É—Å–∞–¥ –∏–¥—ç–≤—Ö—Ç—ç–π —à“Ø“Ø–ª—Ç“Ø“Ø—Ä“Ø“Ø–¥–∏–π–≥ —Ö–∞–¥–≥–∞–ª–∞—Ö #}
      {% for key, value in request.GET.items %}
        {% if key != "kind" and key != "q" %}
          <input type="hidden" name="{{ key }}" value="{{ value }}">
        {% endif %}
      {% endfor %}

      <label for="filter_kind" style="font-weight:600; color:#333;">–¢”©—Ä”©–ª:</label>
      <select id="filter_kind" name="kind" style="min-width:200px; padding: 5px; border:1px solid #ccc; border-radius:4px;">
        <option value="">---------</option>
        {% if KIND_CHOICES %}
          {% for val, label in KIND_CHOICES %}
            <option value="{{ val }}" {% if request.GET.kind == val %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        {% else %}
          {# –•—ç—Ä—ç–≤ KIND_CHOICES –∏—Ä—ç—Ö–≥“Ø–π –±–æ–ª —ç–¥–≥—ç—ç—Ä–∏–π–≥ —Ö–∞—Ä—É—É–ª–Ω–∞ #}
          <option value="WEATHER" {% if request.GET.kind == "WEATHER" %}selected{% endif %}>–¶–∞–≥ —É—É—Ä</option>
          <option value="HYDRO" {% if request.GET.kind == "HYDRO" %}selected{% endif %}>–£—Å —Å—É–¥–ª–∞–ª</option>
          <option value="AWS" {% if request.GET.kind == "AWS" %}selected{% endif %}>AWS</option>
          <option value="ETALON" {% if request.GET.kind == "ETALON" %}selected{% endif %}>–≠—Ç–∞–ª–æ–Ω</option>
          <option value="RADAR" {% if request.GET.kind == "RADAR" %}selected{% endif %}>–†–∞–¥–∞—Ä</option>
          <option value="AEROLOGY" {% if request.GET.kind == "AEROLOGY" %}selected{% endif %}>–ê—ç—Ä–æ–ª–æ–≥–∏</option>
          <option value="AGRO" {% if request.GET.kind == "AGRO" %}selected{% endif %}>–•”©–¥”©”© –∞–∂ –∞—Ö—É–π</option>
          <option value="OTHER" {% if request.GET.kind == "OTHER" %}selected{% endif %}>–ë—É—Å–∞–¥</option>
        {% endif %}
      </select>

      <input type="search" name="q" placeholder="–•–∞–π—Ö..." value="{{ request.GET.q|default_if_none:'' }}" style="min-width:220px; padding:6px 8px; border:1px solid #ccc; border-radius:4px;">

      <button type="submit" class="button" style="background:#447e9b; color:white; border:none; border-radius:4px; padding:6px 12px; cursor:pointer;">–®“Ø“Ø—Ö</button>
      <a class="button" href="." style="text-decoration:none; background:#999; color:white; border-radius:4px; padding:6px 12px;">Reset</a>
    </form>
  </div>

  <script>
    (function () {
      const el = document.getElementById("filter_kind");
      const form = document.getElementById("dev-filter-form");
      // –°–æ–Ω–≥–æ–ª—Ç —Ö–∏–π—Ö—ç–¥ —à—É—É–¥ —Ö–∞–π—Ö
      if (el && form) el.addEventListener("change", function(){ form.submit(); });
    })();
  </script>
{% endblock %}
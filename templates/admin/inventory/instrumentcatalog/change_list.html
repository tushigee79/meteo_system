{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
  {{ block.super }}
  <script src="{% static 'inventory/js/admin/changelist_auto_submit.js' %}"></script>
{% endblock %}

{% block search %}
  {{ block.super }}

  <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
    <form id="cat-filter-form" method="get" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      {% for key, value in request.GET.items %}
        {% if key != "kind" and key != "q" %}
          <input type="hidden" name="{{ key }}" value="{{ value }}">
        {% endif %}
      {% endfor %}

      <label for="filter_kind" style="font-weight:600;">Төрөл:</label>
      <select id="filter_kind" name="kind" style="min-width:200px;">
        <option value="">---------</option>
        {% if KIND_CHOICES %}
          {% for val, label in KIND_CHOICES %}
            <option value="{{ val }}" {% if request.GET.kind == val %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        {% else %}
          <option value="WEATHER" {% if request.GET.kind == "WEATHER" %}selected{% endif %}>Цаг уур</option>
          <option value="HYDRO" {% if request.GET.kind == "HYDRO" %}selected{% endif %}>Ус судлал</option>
          <option value="AWS" {% if request.GET.kind == "AWS" %}selected{% endif %}>AWS</option>
          <option value="ETALON" {% if request.GET.kind == "ETALON" %}selected{% endif %}>Эталон</option>
          <option value="RADAR" {% if request.GET.kind == "RADAR" %}selected{% endif %}>Радар</option>
          <option value="AEROLOGY" {% if request.GET.kind == "AEROLOGY" %}selected{% endif %}>Аэрологи</option>
          <option value="AGRO" {% if request.GET.kind == "AGRO" %}selected{% endif %}>Хөдөө аж ахуй</option>
          <option value="OTHER" {% if request.GET.kind == "OTHER" %}selected{% endif %}>Бусад</option>
        {% endif %}
      </select>

      <input type="search" name="q" placeholder="Хайх..." value="{{ request.GET.q|default_if_none:'' }}" style="min-width:220px; padding:6px 8px;">

      <button type="submit" class="button">Шүүх</button>
      <a class="button" href="." style="text-decoration:none;">Reset</a>
    </form>
  </div>

  <script>
    (function () {
      const el = document.getElementById("filter_kind");
      const form = document.getElementById("cat-filter-form");
      if (el && form) el.addEventListener("change", function(){ form.submit(); });
    })();
  </script>
{% endblock %}
